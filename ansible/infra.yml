---
- import_playbook: basics.yml
- hosts: all
  become: yes
  become_user: root
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:
    - name: create directory if they don't exist
      file:
        path: "{{ item }}"
        state: directory
        owner: pi
        group: pi
        mode: 0775
      loop:
        - /srv/container/infra
        - /srv/container/infra/registry/
        - /srv/container/infra/registry/data

    - name: copy docker-compose for infra parts
      copy:
        src: "../infra/docker-compose.yml"
        dest: /srv/container/infra/docker-compose.yml
        owner: pi
        group: pi
      register: compose_file

    - name: "run docker-compose after change"
      shell: cd /srv/container/infra/ && docker-compose up -d
      when: compose_file.changed
